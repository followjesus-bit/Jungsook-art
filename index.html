<script>
  const photos = [];
  for (let i = 1; i <= 58; i++) {
    const num = String(i).padStart(3, '0');
    photos.push({ src: `images/${num}.png`, id: `${num}.png` });
  }

  let currentIndex = 0;
  let captions = {};

  fetch('comments.json')
    .then(response => response.json())
    .then(data => {
      captions = Object.fromEntries(data.map(entry => [entry.file, entry]));
      updateViewer();
    })
    .catch(error => {
      console.error("Failed to load captions:", error);
      updateViewer(); // fallback to image-only
    });

  function updateViewer() {
    const photo = photos[currentIndex];
    const img = document.getElementById("photo");
    img.src = photo.src;
    document.getElementById("index").innerText = `${currentIndex + 1} / ${photos.length}`;

    const entry = captions[photo.id];
    document.getElementById("caption").innerText = entry?.ko?.join(' / ') || '⚠️ No caption available.';
  }

  function prevPhoto() {
    currentIndex = (currentIndex - 1 + photos.length) % photos.length;
    updateViewer();
  }

  function nextPhoto() {
    currentIndex = (currentIndex + 1) % photos.length;
    updateViewer();
  }

  document.getElementById("photo").onerror = function() {
    console.warn("Image failed to load:", photos[currentIndex].src);
    nextPhoto();
  };

  document.getElementById("photo").addEventListener('click', (event) => {
    const midpoint = event.target.clientWidth / 2;
    if (event.offsetX < midpoint) {
      prevPhoto();
    } else {
      nextPhoto();
    }
  });
</script>
